# 数据库分库分表知识总结
## 关键概念及名词
### 分库
- 概念

  > 把原本存储于一个库的数据分块存储到多个库上
  
### 分表
- 概念

  > 把原本存储于一个表的数据分块存储到多个表上
  
### 垂直拆分
- 概念

  > 将业务紧密，表间关联密切的表划分在一起，例如同一模块的表。例如，我们会建立定义数据库workDB、商品数据库payDB、用户数据库userDB、日志数据库logDB等，分别用于存储项目数据定义表、商品定义表、用户数据表、日志数据表等。
  
- 特点

  > 可以使用join、group by、order by等语句
  
### 水平拆分
- 概念

  > 垂直切分后，需要对shard内表的数据量和增速进一步分析，以确定是否需要进行水平拆分。当一个表中的数据量过大时，我们可以把该表的数据按照某种规则，例如userID散列、按性别、按省，进行划分，然后存储到多个结构相同的表，和不同的库上。例如，我们的userDB中的用户数据表中，每一个表的数据量都很大，就可以把userDB切分为结构相同的多个userDB：part0DB、part1DB等，再将userDB上的用户数据表userTable，切分为很多userTable：userTable0、userTable1等，然后将这些表按照一定的规则存储到多个userDB上。
  
- 特点

  > 在书写sql时，跨shard的join、group by、order by都将被禁止，需要在应用程序层面协调解决这些问题。

### 垂直拆分和水平拆分的选择
应该使用哪一种方式来实施数据库分库分表，这要看数据库中数据量的瓶颈所在，并综合项目的业务类型进行考虑。

如果数据库是因为表太多而造成海量数据，并且项目的各项业务逻辑划分清晰、低耦合，那么规则简单明了、容易实施的垂直切分必是首选。

而如果数据库中的表并不多，但单表的数据量很大、或数据热度很高，这种情况之下就应该选择水平切分，水平切分比垂直切分要复杂一些，它将原本逻辑上属于一体的数据进行了物理分割，除了在分割时要对分割的粒度做好评估，考虑数据平均和负载平均，后期也将对项目人员及应用程序产生额外的数据管理负担。

在现实项目中，往往是这两种情况兼而有之，这就需要做出权衡，甚至既需要垂直切分，又需要水平切分。我们的游戏项目便综合使用了垂直与水平切分，我们首先对数据库进行垂直切分，然后，再针对一部分表，通常是用户数据表，进行水平切分。
### 分库分表应用场景及解决方案
- 场景一：用户中心，单key业务如何进行数据库切分
- 场景二：订单中心，多key业务如何进行数据库切分

## FQA
- 分库分表带来的问题

    - 自动扩缩容

    - 数据一致性

    - 性能

    - 自增列

    - 事务

    - 管理工具（包括监控、性能分析、数据迁移、数据校验与修复、日常报表、问题排查等工具）
  
  
## 参考资料
- [分库分表概念](https://www.cnblogs.com/junwangzhe/p/6420049.html)
- [数据库分库分表的应用场景及解决方案](https://blog.csdn.net/sunhuiliang85/article/details/78418546)
